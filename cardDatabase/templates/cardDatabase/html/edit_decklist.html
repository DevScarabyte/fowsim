{% extends 'cardDatabase/html/database_base.html' %}
{% load static %}
{% block subtitle %} - {{ decklist.name }}{% endblock %}

{% block use_default_submit %}false{% endblock %}

{% block css %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'css/search.css' %}">
    {% if request.user_agent.is_mobile or request.user_agent.is_tablet %}
        <link rel="stylesheet" href="{% static 'css/search_mobile.css' %}">
    {% endif %}
    <link rel="stylesheet" href="{% static 'css/edit_decklist.css' %}">
{% endblock %}

{% block js %}
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://code.jquery.com/ui/1.13.1/jquery-ui.js"></script>
    <script type="text/javascript">
        //uses 3.6.0 for sortable (drag and drop), dont want it to override normal jQuery as $, so assign it to a new name, then load jquery from block.super
        let jQuery_3_6_0 = $.noConflict(true);
    </script>
    {{ block.super }}
    <script src="{% static 'js/search.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/edit_decklist.js' %}" type="text/javascript"></script>
{% endblock %}

{% block body %}
    <div id="database-container">
        {% block database %}
            {{ block.super }}
        {% endblock %}
    </div>
    <div id="decklist-container">
        {% csrf_token %}
        <div class="decklist-name" contenteditable="true">
            {{ decklist.name }}
        </div>
        <div class="deck-zones-container">
            {% for zone in zones %}
                <div class="deck-zone">
                    <div class="deck-zone-title-container">
                        <div class="zone-count"></div>
                        <div class="deck-zone-title" contenteditable="true">
                            {{ zone.zone.name }}
                        </div>
                        <div class="remove-zone"><span>&#10006;</span></div>
                    </div>
                    {# .deck-zone-cards is duplicated in the js in edit_decklist.js #}
                    <div class="deck-zone-cards">
                        {% for card in decklist_cards %}
                            {% if card.zone == zone %}
                                <div class="deck-zone-card" data-card-id="{{ card.card.card_id }}">
                                    <div class="card-quantity">
                                        <a href="#/" class="card-quantity-minus"><span>-</span></a>
                                        <input type="text" class="card-quantity-input" value="{{ card.quantity }}">
                                        <a href="#/" class="card-quantity-plus"><span>+</span></a>
                                    </div>
                                    {# Can't have whitespace around card name to match jquery #}
                                    <div class="deck-zone-card-name">{{ card.card.name }}<img class="hover-card-img" src="{{ card.card.card_image.url }}"></div>
                                    <div class="remove-card">&#10006;</div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            {% endfor %}
        </div>
        <div class="deck-actions">
            <button id="save-deck-button" type="button">Save</button>
            <a href="{% url 'cardDatabase-user-decklists' %}">
                <button type="button">Cancel</button>
            </a>
            <button id="new-zone-button" type="button">Add New Zone</button>
        </div>
    </div>
{% endblock %}
